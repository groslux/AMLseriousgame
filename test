import streamlit as st
import gspread
from oauth2client.service_account import ServiceAccountCredentials

def connect_to_sheet():
    scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
    creds_dict = st.secrets["gcp_service_account"]
    creds = ServiceAccountCredentials.from_json_keyfile_dict(dict(creds_dict), scope)
    client = gspread.authorize(creds)
    sheet = client.open("AML_Leaderboard").sheet1
    return sheet

try:
    sheet = connect_to_sheet()
    st.success("‚úÖ Connected to Google Sheet!")
    records = sheet.get_all_records()
    st.write(f"üìÑ Found {len(records)} rows:")
    st.dataframe(records)
except Exception as e:
    st.error(f"‚ùå Could not connect: {e}")
